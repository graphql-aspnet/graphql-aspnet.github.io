"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[5436],{346:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/console-logger-292925d3a6989984be2dcf13e62efdcb.png"},3349:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"logging/structured-logging","title":"Structured Logging","description":"GraphQL ASP.NET utilizes structured logging for reporting runtime events. The log messages generated aren\'t just strings but actual objects. All internal log events are raised as objects that inherit from IGraphLogEntry.","source":"@site/docs/logging/structured-logging.md","sourceDirName":"logging","slug":"/logging/structured-logging","permalink":"/docs/logging/structured-logging","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"id":"structured-logging","title":"Structured Logging","sidebar_label":"Structured Logging","sidebar_position":0},"sidebar":"tutorialSidebar","previous":{"title":"Multi-Schema Support","permalink":"/docs/advanced/multi-schema-support"},"next":{"title":"Standard Events","permalink":"/docs/logging/standard-events"}}');var o=t(4848),i=t(8453);const a={id:"structured-logging",title:"Structured Logging",sidebar_label:"Structured Logging",sidebar_position:0},s=void 0,l={},d=[{value:"IServiceCollection.AddLogging()",id:"iservicecollectionaddlogging",level:2},{value:"Using IGraphLogger",id:"using-igraphlogger",level:2},{value:"Custom ILoggers",id:"custom-iloggers",level:2},{value:"Log Entries are KeyValuePair Collections",id:"log-entries-are-keyvaluepair-collections",level:2},{value:"Logging Category",id:"logging-category",level:2},{value:"Scoped Log Entries",id:"scoped-log-entries",level:3}];function g(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["GraphQL ASP.NET utilizes structured logging for reporting runtime events. The log messages generated aren't just strings but actual objects. All internal log events are raised as objects that inherit from ",(0,o.jsx)(n.code,{children:"IGraphLogEntry"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"iservicecollectionaddlogging",children:"IServiceCollection.AddLogging()"}),"\n",(0,o.jsx)(n.p,{children:"GraphQL's logging extends off of .NET's built in logging framework. To enable it, you need to register logging to your application at startup. By doing so, GraphQL will automatically wire up its own logging as well."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",metastring:'title="Register Standard Logging"',children:"// Adding Logging before calling AddGraphQL\nservices.AddLogging();\n\nservice.AddGraphQL(/*...*/);\n"})}),"\n",(0,o.jsx)(n.h2,{id:"using-igraphlogger",children:"Using IGraphLogger"}),"\n",(0,o.jsxs)(n.p,{children:["Its common practice to inject an instance of ",(0,o.jsx)(n.code,{children:"ILogger"})," or ",(0,o.jsx)(n.code,{children:"ILoggerFactory"})," into a controller in order to log various events of your controller methods."]}),"\n",(0,o.jsxs)(n.p,{children:["This is fully supported but the library can also generate an instance of ",(0,o.jsx)(n.code,{children:"IGraphLogger"}),' with a few helpful methods for raising "on the fly" log entries if you wish to make use of it. ',(0,o.jsx)(n.code,{children:"IGraphLogger"})," implements ",(0,o.jsx)(n.code,{children:"ILogger"}),", the two can be used interchangeably as needed."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",metastring:'title="Using IGraphLogger"',children:'public class BakeryController : GraphController\n{\n    private IGraphLogger _graphLogger;\n    private IDonutService _service;\n    // highlight-next-line\n    public BakeryController(IDonutService service, IGraphLogger graphLogger)\n    {\n        _service = service;\n        _graphLogger = graphLogger;\n    }\n\n    [MutationRoot]\n    public Donut CreateDonut(string name)\n    {\n        Donut donut = _service.CreateDonut(name);\n\n        // highlight-start\n        var donutEvent = new GraphLogEntry("New Donut Created!");\n        donutEvent["Name"] = name;\n        donutEvent["Id"] = donut.Id;\n\n        _graphLogger.Log(LogLevel.Information, donutEvent);\n        // highlight-end\n\n        return donut;\n    }\n}\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"GraphLogEntry"})," is an untyped implementation of ",(0,o.jsx)(n.code,{children:"IGraphLogEntry"})," and can be used on the fly for quick operations or as a basis for custom log entries."]})}),"\n",(0,o.jsx)(n.h2,{id:"custom-iloggers",children:"Custom ILoggers"}),"\n",(0,o.jsxs)(n.p,{children:["By default, the log events will return a contextual message on ",(0,o.jsx)(n.code,{children:".ToString()"})," with the important data related to the event. This is very handy when logging to the console during development."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"console logger",src:t(346).A+"",width:"1326",height:"767"})}),"\n",(0,o.jsxs)(n.p,{children:["But given the extra data the log entries contain, it makes more sense to create a custom ",(0,o.jsx)(n.code,{children:"ILogger"})," to take advantage of the full object."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",metastring:'title="Custom ILogger"',children:"public class MyCustomLogger : ILogger\n{\n    // other code ommited for brevity\n\n    public void Log<TState>(LogLevel logLevel, EventId eventId,\n        TState state, Exception exception, Func<TState, Exception, string> formatter)\n    {\n        // highlight-next-line\n        if (state is IGraphLogEntry logEntry)\n        {\n            // handle the log entry here\n        }\n    }\n}\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["The state parameter of ",(0,o.jsx)(n.code,{children:"ILogger.Log()"})," will be an instance of ",(0,o.jsx)(n.code,{children:"IGraphLogEntry"})," whenever a GraphQL ASP.NET log event is recorded."]})}),"\n",(0,o.jsx)(n.h2,{id:"log-entries-are-keyvaluepair-collections",children:"Log Entries are KeyValuePair Collections"}),"\n",(0,o.jsxs)(n.p,{children:["While the various ",(0,o.jsx)(n.a,{href:"./standard-events",children:"standard log events"})," declare explicit properties for the data they return, every log entry is just a collection of key/value pairs that can be iterated through for quick serialization."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:"public interface IGraphLogEntry : IEnumerable<KeyValuePair<string, object>>\n{ /*...*/ }\n"})}),"\n",(0,o.jsx)(n.h2,{id:"logging-category",children:"Logging Category"}),"\n",(0,o.jsxs)(n.p,{children:["All log events are registered under the the ",(0,o.jsx)(n.code,{children:"GraphQL.AspNet"})," category. With the exception of field authorization fails, all log events are recorded at ",(0,o.jsx)(n.code,{children:"Debug"})," or ",(0,o.jsx)(n.code,{children:"Trace"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Here we've enabled the log events through ",(0,o.jsx)(n.code,{children:"appsettings.json"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",metastring:'title="appsettings.json"',children:'{\n    "Logging" : {\n        "IncludeScopes" : false,\n        "LogLevel": {\n            "Default" : "Information",\n            "System": "Debug",\n            "Microsoft": "Information",\n            // highlight-next-line\n            "GraphQL.AspNet" : "Debug"\n        }\n    }\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Log Entries are not allocated unless their respective log levels are enabled. It is not uncommon for real world queries to generate 100s of log entries per request. Take care to ensure you have setup your logging appropriately in a given environment as it can greatly impact performance if left on by accident."}),"\n",(0,o.jsxs)(n.admonition,{type:"caution",children:[(0,o.jsx)(n.mdxAdmonitionTitle,{}),(0,o.jsx)(n.p,{children:"It is never a good idea to enable trace level logging outside of development."})]}),"\n",(0,o.jsx)(n.h3,{id:"scoped-log-entries",children:"Scoped Log Entries"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"IGraphLogger"}),' is generated from your service provider on a "per scope" basis. By default, this is at the HTTP Request level. Any log entries created through it using ',(0,o.jsx)(n.code,{children:".Log(LogLevel, IGraphLogEntry)"})," will be injected with a ",(0,o.jsx)(n.code,{children:"scopeId"})," and along with the date can produce a complete record of a request from when it was received through query plan generation, authorization and field resolution."]}),"\n",(0,o.jsxs)(n.p,{children:["Here we've used a custom ",(0,o.jsx)(n.code,{children:"ILogProvider"})," and written out a small sample of events to a json array. Note the shared ",(0,o.jsx)(n.code,{children:"scopeId"})," on each entry. See the ",(0,o.jsx)(n.a,{href:"/docs/reference/demo-projects",children:"example projects"})," to download the code."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'[{\n  "eventId": 86000,\n  "eventName": "GraphQL Request Received",\n  "dateTimeUTC": "2022-09-23T22:05:39.6023597+00:00",\n  "logEntryId": "6afdf3d1f9464679becfbd2b96aa594f",\n  "operationRequestId": "a13f5f7232dc475783c4e4798cfb50d2",\n  "userName": "john-doe",\n  "queryOperationName": null,\n  "queryText": "query {\\n  hero(episode: EMPIRE){\\n    id\\n    name    \\n  }\\n}",\n  "scopeId": "3c3c858b1b344d0b9c0f8ac6b95469d1"\n},\n{\n  "eventId": 86400,\n  "eventName": "GraphQL Query Plan Generated",\n  "dateTimeUTC": "2022-09-23T22:05:39.7214431+00:00",\n  "logEntryId": "d133e032e2fc42a98a639ee8c72d2497",\n  "schemaType": "GraphQL.AspNet.Schemas.GraphSchema",\n  "isValid": true,\n  "operationCount": 1,\n  "estimatedComplexity": 9.5076,\n  "maxDepth": 2,\n  "queryPlanId": "57caffc5d5124f2fb08419ae99724974",\n  "scopeId": "3c3c858b1b344d0b9c0f8ac6b95469d1"\n},\n{\n  "eventId": 86599,\n  "eventName": "GraphQL Field Resolution Completed",\n  "path": "[type]/Human/Id",\n  "dateTimeUTC": "2022-09-23T22:05:39.8528847+00:00",\n  "logEntryId": "750ee155bf7e4eea895e5eec01d3fb6d",\n  "pipelineRequestId": "aa670d3e2d6a41e1b314711acf6bc51c",\n  "typeExpression": "ID!",\n  "hasData": true,\n  "resultIsValid": true,\n  "scopeId": "3c3c858b1b344d0b9c0f8ac6b95469d1"\n}]\n'})})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(g,{...e})}):g(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var r=t(6540);const o={},i=r.createContext(o);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);