"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[2552],{8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var r=t(6540);const i={},o=r.createContext(i);function a(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(o.Provider,{value:n},e.children)}},8922:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"quick/code-examples","title":"Code Examples","description":"Below is a quick introduction to some common scenarios and the C# code to support them.","source":"@site/docs/quick/code-examples.md","sourceDirName":"quick","slug":"/quick/code-examples","permalink":"/docs/quick/code-examples","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"code-examples","title":"Code Examples","sidebar_label":"Code Examples","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Your First App","permalink":"/docs/quick/create-app"},"next":{"title":"What is GraphQL?","permalink":"/docs/introduction/what-is-graphql"}}');var i=t(4848),o=t(8453);const a={id:"code-examples",title:"Code Examples",sidebar_label:"Code Examples",sidebar_position:2},s=void 0,l={},c=[{value:"Configuring Services",id:"configuring-services",level:2},{value:"A Basic Controller",id:"a-basic-controller",level:2},{value:"Using an Interface",id:"using-an-interface",level:2},{value:"Field Paths",id:"field-paths",level:2},{value:"Dependency Injection",id:"dependency-injection",level:2},{value:"Authorization",id:"authorization",level:2},{value:"\u2705 Notes on Authorization",id:"-notes-on-authorization",level:4},{value:"Mutations &amp; Model State",id:"mutations--model-state",level:2},{value:"Action Results",id:"action-results",level:2}];function d(e){const n={admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Below is a quick introduction to some common scenarios and the C# code to support them."}),"\n",(0,i.jsx)(n.h2,{id:"configuring-services",children:"Configuring Services"}),"\n",(0,i.jsxs)(n.p,{children:['The library uses a standard "Add & Use" pattern for configuring services with your application. A route is added to the ASP.NET request pipeline to handle GET and POST requests when you call ',(0,i.jsx)(n.code,{children:".UseGraphQL()"}),". Place it as appropriate amongst any other configurations, routes, authorization etc. when you build your pipeline."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="Program.cs"',children:"var builder = WebApplication.CreateBuilder(args);\n\n// Add graphql services to the DI container\n// highlight-next-line\nbuilder.Services.AddGraphQL();\n\nvar app = builder.Build();\n\n// Configure the HTTP request pipeline\n// highlight-next-line\napp.UseGraphQL();\napp.Run();\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"_The configuration steps may vary slightly when using a Startup.cs file; typical for .NET 5 or earlier _"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"a-basic-controller",children:"A Basic Controller"}),"\n",(0,i.jsx)(n.p,{children:"A simple controller to return data based on a string value."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Notice we inherit from ",(0,i.jsx)(n.code,{children:"GraphController"})," not the standard web api Controller."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="HeroController.cs"',children:'// highlight-next-line\npublic class HeroController : GraphController\n{\n    [QueryRoot]\n    public Human Hero(string episode)\n    {\n        if(episode == "Empire")\n        {\n            return new Human()\n            {\n                Id = 1000,\n                Name = "Han Solo",\n                HomePlanet = "Corellia",\n            }\n        }\n        else\n        {\n            return new Human()\n            {\n                Id = 1001,\n                Name = "Luke SkyWalker",\n                HomePlanet = "Tatooine",\n            }\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",metastring:'title="Sample Query"',children:'query {\n    hero(episode: "Empire") {\n        name\n        homePlanet\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="JSON Result" ',children:'{\n    "data" : {\n        "hero": {\n            "name" : "Han Solo",\n            "homePlanet" : "Corellia"\n        }\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.admonition,{title:"Did you notice?",type:"info",children:[(0,i.jsxs)(n.p,{children:["In the query the hero field is ",(0,i.jsx)(n.code,{children:"camelCased"})," but in C# the method is ",(0,i.jsx)(n.code,{children:"ProperCased"}),"? Field names are automatically translated to standard GraphQL conventions. The same goes for your graph type names, enum values etc."]}),(0,i.jsxs)(n.p,{children:["You can also implement your own ",(0,i.jsx)(n.code,{children:"GraphNameFormatter"})," and alter the name formats for each of your registered schemas."]})]}),"\n",(0,i.jsx)(n.h2,{id:"using-an-interface",children:"Using an Interface"}),"\n",(0,i.jsx)(n.p,{children:"If your models share a common interface just return it from a controller action and the library will create the appropriate graph types for you."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Don't forget to declare the object types that implement your interface (e.g. Droid and Human) or the library won't know what resolvers to invoke at runtime. In this example, we've declared them inline but you can easily add them at startup to reduce the noise."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="HeroController.cs"',children:'public class HeroController : GraphController\n{\n    // highlight-next-line\n    [QueryRoot(typeof(Droid), typeof(Human))]\n    // highlight-next-line\n    public ICharacter Hero(Episode episode)\n    {\n        if(episode == Episode.Empire)\n        {\n            return new Human()\n            {\n                Id = 1000,\n                Name = "Han Solo",\n                HomePlanet = "Corellia",\n            }\n        }\n        else\n        {\n            return new Droid()\n            {\n                Id = 2000,\n                Name = "R2R2",\n                Type = DroidType.AstroMech\n            }\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",metastring:'title="GraphQL Query"',children:"query {\n    hero(episode: JEDI) {\n        id\n        name\n\n        ... on Human {\n            homePlanet\n        }\n\n        ... on Droid {\n            type\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"field-paths",children:"Field Paths"}),"\n",(0,i.jsxs)(n.p,{children:["We've used ",(0,i.jsx)(n.code,{children:"[QueryRoot]"})," so far to force a controller action to be a root field on the ",(0,i.jsx)(n.code,{children:"query"})," type. But we can use an approximation of Web API's url templates to create any combination of nested fields needed. When you have 50 controllers with 20-40 actions each, organizing your object hierarchy becomes trivial."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="RebelAllianceController.cs"',children:'// highlight-next-line\n[GraphRoute("rebels")]\npublic class RebelAllianceController : GraphController\n{\n    // highlight-next-line\n    [Query("directory/hero")]\n    public Human RetrieveHero(Episode episode)\n    {\n        // Wedge is the true hero\n        return new Human()\n        {\n            Id = 1003,\n            Name = "Wedge Antilles",\n            HomePlanet = "Corellia",\n        };\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",metastring:'title="Sample Query"',children:"query {\n    rebels {\n        directory {\n            hero(episode: EMPIRE) {\n                name\n                homePlanet\n            }\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"dependency-injection",children:"Dependency Injection"}),"\n",(0,i.jsx)(n.p,{children:"At runtime,  GraphQL invokes your graph controllers and injected services with the same dependency scope as the original HTTP Request. Add a known service to a controller's constructor and it will be automatically resolved with its configured scope."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",metastring:'title="PersonsController.cs"',children:'public class PersonsController : GraphController\n{\n    private IPersonService _personService;\n    // highlight-next-line\n    public PersonsController(IPersonService service)\n    {\n        _personService = service;\n    }\n\n    [QueryRoot("person")]\n    public async Task<Human> RetrievePerson(int id)\n    {\n        return await _personService.RetrievePerson(id);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",metastring:'title="Query"',children:"query {\n    person(id: 1000) {\n        id\n        name\n        homePlanet\n    }\n}\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"Did You Notice?",type:"info",children:(0,i.jsxs)(n.p,{children:["We switched to an asynchronous method with ",(0,i.jsx)(n.code,{children:"Task<Human>"}),". GraphQL ASP.NET follows your lead and will execute your actions asynchronously or synchronously as needed."]})}),"\n",(0,i.jsx)(n.h2,{id:"authorization",children:"Authorization"}),"\n",(0,i.jsxs)(n.p,{children:["Add the ",(0,i.jsx)(n.code,{children:"[Authorize]"})," attribute and you're done. GraphQL ASP.NET uses the same authorization pipeline as your application."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="PersonsController.cs"',children:'public class PersonsController : GraphController\n{\n    private IPersonService _personService;\n    public PersonsController(IPersonService service)\n    {\n        _personService = service;\n    }\n\n    // highlight-next-line\n    [Authorize]\n    [QueryRoot("self")]\n    public async Task<Employee> RetrievePerson()\n    {\n        return await _personService.RetrievePerson(this.User.Name);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",metastring:'title="Sample Query"',children:"query {\n    self {\n        id\n        name\n        title\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"-notes-on-authorization",children:"\u2705 Notes on Authorization"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Your controller actions have full access to the same ",(0,i.jsx)(n.code,{children:"ClaimsPrincipal"})," that you get with ",(0,i.jsx)(n.code,{children:"this.User"})," on an web api controller. In fact, its the same object reference."]}),"\n",(0,i.jsxs)(n.li,{children:["Out of the box, the library performs authorization on a \"per field\" basis. This includes POCO object properties! If you have a piece of sensitive data attached to a property, say Birthday, on your Person model, you can apply a policy or role to it. Unauthorized user's won't be able to query for that field, even if they can access the controller that produced the object its attached or every other field on the object.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Note: You'll have to implement .NET's"})," ",(0,i.jsx)(n.code,{children:"IAuthorizeData"})," ",(0,i.jsx)(n.em,{children:"interface on your own custom attribute, the"})," ",(0,i.jsx)(n.code,{children:"[Authorize]"})," ",(0,i.jsx)(n.em,{children:"attribute provided by .NET does not allow targeting of properties."})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"GraphQL obeys layered authorization requirements as well. Place an authorization attribute at the controller level and it'll be checked before any method level requirements."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"mutations--model-state",children:"Mutations & Model State"}),"\n",(0,i.jsxs)(n.p,{children:["GraphQL ASP.NET will automatically enforce the query specification rules for you, but that doesn't help for business-level requirements like string length or integer ranges. For that, it uses the familiar goodness of Validation Attributes (e.g. ",(0,i.jsx)(n.code,{children:"[StringLength]"}),", ",(0,i.jsx)(n.code,{children:"[Range]"})," etc.)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="PersonsController.cs"',children:'public class PersonsController : GraphController\n{\n    /* constructor hidden for brevity */\n\n    [MutationRoot("joinTheResistance")]\n    public async Task<Human> CreatePerson(Human model)\n    {\n        // ***************************\n        // Check if the model passed validation\n        // requirements before using it\n        // ***************************\n        // highlight-start\n        if(!this.ModelState.IsValid)\n            return null;\n        // highlight-end\n\n        return await _service.CreatePerson(model);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'title="Human.cs"',children:"public class Human\n{\n    public int? Id{ get; set; }\n\n    // highlight-next-line\n    [StringLength(35)]\n    public string Name { get; set; }\n\n    public string HomePlanet { get; set; }\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",metastring:'title="Sample Query"',children:'mutation {\n    joinTheResistance(\n        newPerson: {\n            name: "Lando Calrissian"\n            homePlanet: "Bespin" }) {\n        id\n        name\n        homePlanet\n    }\n}\n'})}),"\n",(0,i.jsx)(n.admonition,{title:"Did You Notice?",type:"info",children:(0,i.jsxs)(n.p,{children:["We used ",(0,i.jsx)(n.code,{children:"Human"})," as an input argument ",(0,i.jsx)(n.strong,{children:"and"})," as the returned data object. The library will automatically generate the appropriate graph types for ",(0,i.jsx)(n.code,{children:"INPUT_OBJECT"})," and ",(0,i.jsx)(n.code,{children:"OBJECT"}),", respectively,  add them to your schema when needed."]})}),"\n",(0,i.jsx)(n.h2,{id:"action-results",children:"Action Results"}),"\n",(0,i.jsxs)(n.p,{children:["Just as Web API makes use of ",(0,i.jsx)(n.code,{children:"IActionResult"})," to perform post processing on the result of a controller method, GraphQL ASP.NET makes use of ",(0,i.jsx)(n.code,{children:"IGraphActionResult"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Reusing the previous example, here we make use of ",(0,i.jsx)(n.code,{children:"this.BadRequest()"})," to automatically generate an appropriate error message in the response when model validation fails. Field origin information including the path array and line/column number of the original query are wired up automatically."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'// C# Controller\npublic class PersonsController : GraphController\n{\n    [MutationRoot("joinTheResistance", typeof(Human))]\n    public async IGraphActionResult CreatePerson(Human model)\n    {\n        // ***************************\n        // Check if the model passes validation\n        // requirements before using it\n        // ***************************\n        if(!this.ModelState.IsValid)\n        // highlight-next-line\n            return this.BadRequest(this.ModelState);\n\n        var result = await _service.CreatePerson(model);\n        return result != null\n        // highlight-start\n            ? this.Ok(result)\n            : this.Error("Woops Something broke");\n        // highlight-end\n    }\n}\n\npublic class Human\n{\n    public int? Id{ get; set; }\n\n    [StringLength(35)]\n    public string Name { get; set; }\n\n    public string HomePlanet { get; set; }\n}\n'})}),"\n",(0,i.jsx)(n.admonition,{title:"GraphQL is not Rest",type:"note",children:(0,i.jsxs)(n.p,{children:["Unlike WebAPI, ",(0,i.jsx)(n.code,{children:"BadRequest()"}),' doesn\'t generate a HTTP Status 400 error for the request. If there are multiple controller methods being resolved GraphQL can still generate a partial response and render data for other parts of the query. Most "error" related action results add a standard error message to the result with different reason codes.']})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);