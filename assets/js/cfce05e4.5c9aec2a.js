"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[4338],{3782:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"controllers/model-state","title":"Model State","description":"What is Model State?","source":"@site/docs/controllers/model-state.md","sourceDirName":"controllers","slug":"/controllers/model-state","permalink":"/docs/controllers/model-state","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"model-state","title":"Model State","sidebar_label":"Model State","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Actions","permalink":"/docs/controllers/actions"},"next":{"title":"Field Paths","permalink":"/docs/controllers/field-paths"}}');var i=n(4848),s=n(8453);const o={id:"model-state",title:"Model State",sidebar_label:"Model State",sidebar_position:1},r=void 0,l={},d=[{value:"What is Model State?",id:"what-is-model-state",level:2},{value:"Using Model Validation",id:"using-model-validation",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"what-is-model-state",children:"What is Model State?"}),"\n",(0,i.jsx)(t.p,{children:"GraphQL, as a language, can easily enforce query level requirements like :"}),"\n",(0,i.jsxs)(t.p,{children:["\u2705   The data must a collection.",(0,i.jsx)("br",{}),"\n\u2705   The data value cannot be null.",(0,i.jsx)("br",{}),"\n\u2705   The argument 'zipCode' must be supplied as a string."]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(t.p,{children:"But it fails to enforce the individual business level requirements:"}),"\n",(0,i.jsxs)(t.p,{children:["\ud83e\udde8   The employee's last name must be less than 70 characters.",(0,i.jsx)("br",{}),"\n\ud83e\udde8   A customer's phone number should be 7 or 10 digits.",(0,i.jsx)("br",{}),"\n\ud83e\udde8   A customer must order at least 1 donut."]}),"\n",(0,i.jsx)(t.p,{children:"This is where model state can come in handy. Its completely optional, but if you choose to make use of it, it provides a handy way to inforce business level requirements in your action methods."}),"\n",(0,i.jsx)(t.h2,{id:"using-model-validation",children:"Using Model Validation"}),"\n",(0,i.jsx)(t.p,{children:"When your controller action is invoked the runtime will analyze the input parameters and execute the validation attributes attached to each object to determine its validation state. This works in the same way as it does with a Web API controller."}),"\n",(0,i.jsxs)(t.p,{children:["In this example we use the ",(0,i.jsx)(t.code,{children:"[Range]"})," attribute to limit the quantity of donuts that can be ordered to three dozen."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",metastring:'title="DonutOrderModel.cs"',children:"public class DonutOrderModel\n{\n    // highlight-next-line\n    [Range(1, 36)]\n    public int Quantity { get; set; }\n    public string Type { get; set; }\n}\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",metastring:'title="BakeryController.cs"',children:'public class BakeryController : GraphController\n{\n    //constructor with service injection omitted for brevity...\n\n    [MutationRoot("orderDonuts", typeof(CompletedDonutOrder))]\n    public async Task<IGraphActionResult> OrderDonuts(DonutOrderModel order)\n    {\n        // highlight-start\n        if (!this.ModelState.IsValid)\n            return this.BadRequest(this.ModelState);\n        // highlight-end\n\n        var result = await _service.PlaceDonutOrder(order);\n        return this.Ok(result);\n    }\n}\n'})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphql",metastring:'title="Sample Query"',children:'# A valid query\n# that breaks a required business rule\nmutation {\n    orderDonuts(order: {quantity: 60, type: "glazed"}) {\n        id\n        name\n    }\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Just like with ASP.NET, ",(0,i.jsx)(t.code,{children:"this.ModelState"}),' contains an entry for each "validatiable" object passed to the method and its current validation state (valid, invalid, skipped etc.) along with all the rules that did not pass. Also, just like with ASP.NET you can define custom attributes that inherit from ',(0,i.jsx)(t.code,{children:"ValidationAttribute"})," and GraphQL will execute them as well."]}),"\n",(0,i.jsxs)(t.p,{children:["In the example, we returned a IGraphActionResult to make use of ",(0,i.jsx)(t.code,{children:"this.BadRequest()"})," which will add the friendly error messages to the outgoing response automatically. But we could have easily just returned null, thrown an exception or generated a generic custom error message. However you choose to deal with ",(0,i.jsx)(t.code,{children:"ModelState"})," is up to you."]}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsx)(t.p,{children:"GraphQL will validate the data but it doesn't take action when model validation fails. That's up to you. If a valid query is provided your action method will be invoked and executed."})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(t.p,{children:["\u26a0\ufe0f ",(0,i.jsx)(t.strong,{children:"Implementation Note"})]}),"\n",(0,i.jsxs)(t.p,{children:["The library makes use of the same ",(0,i.jsx)(t.code,{children:"System.ComponentModel.DataAnnotations.Validator"})," that ASP.NET does to validate its input objects. ",(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/mvc/models/validation?view=aspnetcore-7.0",children:"All the applicable rules"})," that apply to Web API model validation also apply to your controllers and models."]}),"\n",(0,i.jsx)(t.p,{children:"However, where Web API will validate model binding rules and represent binding errors it its ModelState object (such as invalid or missing property names) the GraphQL implementation will not. GraphQL binding issues such as invalid type expressions, nullability and missing arguments are taken care of at the query level, long before a query plan is finalized and the action method is invoked. In fact, your action methods won't even be invoked unless all the correct data was supplied and the query was properly structured."}),"\n",(0,i.jsx)(t.p,{children:"The model state of GraphQL ASP.NET is a close approximation of Web API's model state object, but it is not an exact match."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var a=n(6540);const i={},s=a.createContext(i);function o(e){const t=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);